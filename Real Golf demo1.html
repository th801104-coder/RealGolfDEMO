<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Real Golf!</title>
<style>
body {
  margin:0;
  font-family:sans-serif;
  background:#0b5c2e;
  color:white;
  overflow:hidden;
}
.screen {
  position:absolute;
  width:100%;
  height:100%;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
}
#startScreen {
  background:url("https://images.unsplash.com/photo-1592919505780-303950717480?q=80&w=1600") center/cover;
}
button {
  padding:12px 20px;
  font-size:16px;
  margin:5px;
}
#gameScreen {
  display:none;
}
#layout {
  display:flex;
  height:100%;
}
#left {
  width:50%;
  background:#1f8f3a;
  position:relative;
}
#right {
  width:50%;
  display:flex;
  flex-direction:column;
}
#impactZone {
  flex:1;
  background:#222;
  position:relative;
  display:flex;
  justify-content:center;
  align-items:center;
}
#playerZone {
  flex:1;
  background:#333;
  display:flex;
  justify-content:center;
  align-items:center;
}
#windInfo {
  position:absolute;
  top:10px;
  left:10px;
  font-size:14px;
}
#commentary {
  position:absolute;
  bottom:10px;
  left:10px;
  right:10px;
  font-size:14px;
}
#ballCanvas {
  position:absolute;
  width:100%;
  height:100%;
}
.cursor {
  position:absolute;
  width:20px;
  height:20px;
  border:2px solid yellow;
}
.club-buttons {
  position:absolute;
  bottom:50px;
  left:10px;
}
</style>
</head>
<body>

<div id="startScreen" class="screen">
  <h1>REAL GOLF!</h1>
  <button onclick="startGame()">START</button>
</div>

<div id="gameScreen">
  <div id="layout">
    <div id="left">
      <canvas id="ballCanvas"></canvas>
      <div id="windInfo"></div>
      <div id="commentary"></div>
      <div class="club-buttons">
        <button onclick="selectClub(220)">1W</button>
        <button onclick="selectClub(190)">3W</button>
        <button onclick="selectClub(160)">5I</button>
        <button onclick="selectClub(140)">7I</button>
        <button onclick="selectClub(110)">9I</button>
      </div>
    </div>
    <div id="right">
      <div id="impactZone"></div>
      <div id="playerZone">üèåÔ∏è</div>
    </div>
  </div>
</div>

<script>
let canvas = document.getElementById("ballCanvas");
let ctx = canvas.getContext("2d");
let windSpeed = 0;
let windDir = 0;
let clubPower = 160;
let stage = 0;
let cursor;
let cursorPos = 0;
let direction = 1;
let verticalResult = 0;
let horizontalResult = 0;

function resizeCanvas() {
  canvas.width = canvas.offsetWidth;
  canvas.height = canvas.offsetHeight;
}
window.onresize = resizeCanvas;

function startGame() {
  document.getElementById("startScreen").style.display="none";
  document.getElementById("gameScreen").style.display="block";
  resizeCanvas();
  generateWind();
  startImpact();
}

function generateWind() {
  windSpeed = Math.floor(Math.random()*6);
  windDir = Math.floor(Math.random()*360);
  document.getElementById("windInfo").innerText =
    "È¢®Âêë: " + windDir + "¬∞  È¢®ÈÄü: " + windSpeed + "m";
  aiCommentary();
}

function aiCommentary() {
  let comment;
  if(windSpeed === 0){
    comment="ÁÑ°È¢®„Åß„Åô„ÄÇÁãô„ÅÑÈÄö„ÇäÊâì„Å¶„Åæ„Åô„Å≠„ÄÇ";
  } else if(windSpeed <=2){
    comment="Âº±„ÅÑÈ¢®„Åß„Åô„ÄÇ„ÇÑ„ÇÑÂΩ±Èüø„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ";
  } else if(windSpeed <=4){
    comment="‰∏≠Á®ãÂ∫¶„ÅÆÈ¢®„ÄÇÊñπÂêë„Å´Ê≥®ÊÑè„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ";
  } else {
    comment="Âº∑È¢®„Åß„ÅôÔºÅ„Åó„Å£„Åã„ÇäÈ¢®„ÇíË™≠„Çì„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ";
  }
  document.getElementById("commentary").innerText = comment;
}

function selectClub(power) {
  clubPower = power;
}

function startImpact() {
  stage=1;
  let zone=document.getElementById("impactZone");
  zone.innerHTML="";
  cursor=document.createElement("div");
  cursor.className="cursor";
  zone.appendChild(cursor);
  cursorPos=0;
  direction=1;
  moveVertical();
  zone.onclick=stopVertical;
}

function moveVertical(){
  if(stage!==1)return;
  cursorPos+=direction*5;
  if(cursorPos>zoneHeight()-20||cursorPos<0)direction*=-1;
  cursor.style.top=cursorPos+"px";
  requestAnimationFrame(moveVertical);
}

function zoneHeight(){
  return document.getElementById("impactZone").offsetHeight;
}

function stopVertical(){
  verticalResult=(cursorPos/zoneHeight())-0.5;
  stage=2;
  document.getElementById("impactZone").onclick=stopHorizontal;
  moveHorizontal();
}

function moveHorizontal(){
  if(stage!==2)return;
  cursorPos+=direction*5;
  if(cursorPos>zoneWidth()-20||cursorPos<0)direction*=-1;
  cursor.style.left=cursorPos+"px";
  requestAnimationFrame(moveHorizontal);
}

function zoneWidth(){
  return document.getElementById("impactZone").offsetWidth;
}

function stopHorizontal(){
  horizontalResult=(cursorPos/zoneWidth())-0.5;
  stage=3;
  swing();
}

function swing(){
  document.getElementById("playerZone").innerText="üí•";
  setTimeout(()=>{
    document.getElementById("playerZone").innerText="üèåÔ∏è";
    shootBall();
  },500);
}

function shootBall(){
  let x=50;
  let y=canvas.height-50;
  let angle=-Math.PI/4;
  let power=clubPower*(1-Math.abs(verticalResult));
  let vx=power*Math.cos(angle)/20;
  let vy=power*Math.sin(angle)/20;
  let curve=horizontalResult*2;
  let windX=windSpeed*Math.cos(windDir*Math.PI/180)/5;
  let windY=windSpeed*Math.sin(windDir*Math.PI/180)/5;

  function animate(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.beginPath();
    ctx.arc(x,y,5,0,Math.PI*2);
    ctx.fillStyle="white";
    ctx.fill();

    x+=vx+windX+curve;
    y+=vy+windY;
    vy+=0.3;

    if(y<canvas.height && x<canvas.width){
      requestAnimationFrame(animate);
    } else {
      startImpact();
    }
  }
  animate();
}
</script>
</body>
</html>