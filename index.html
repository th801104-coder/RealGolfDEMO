<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Real Golf</title>

<style>
html,body{
  margin:0;
  height:100%;
  overflow:hidden;
  font-family:sans-serif;
  padding-bottom: env(safe-area-inset-bottom);
}

/* ===== レイアウト（横2分割固定） ===== */
#layout{
  display:flex;
  width:100vw;
  height:100%;
}

/* ===== 左：コース ===== */
#left{
  width:50vw;
  background:#1f8f3a;
  position:relative;
}

#ballCanvas{
  position:absolute;
  inset:0;
}

#windInfo{
  position:absolute;
  top:10px;
  left:10px;
  background:rgba(0,0,0,.5);
  color:white;
  padding:6px 10px;
  border-radius:8px;
  font-size:14px;
  z-index:10;
}

/* クラブ */
.club-buttons{
  position:absolute;
  bottom:70px; /* ← はみ出し防止 */
  left:10px;
  display:flex;
  gap:6px;
  flex-wrap:wrap;
  z-index:10;
}

.club-buttons button{
  padding:8px 12px;
  border:none;
  border-radius:8px;
  font-weight:bold;
  font-size:14px;
}

.club-buttons button.active{
  outline:3px solid gold;
}

/* ===== 右 ===== */
#right{
  width:50vw;
  display:flex;
  flex-direction:column;
}

/* ===== ボールUI ===== */
#impactZone{
  flex:1;
  background:#111;
  display:flex;
  justify-content:center;
  align-items:center;
  position:relative;
}

#ballUI{
  width:220px;
  height:220px;
  position:relative;
}

#ballCircle{
  width:100%;
  height:100%;
  border-radius:50%;
  background:radial-gradient(circle at 30% 30%, white, #ddd);
}

/* 黒太＋カーソル */
#impactCursor{
  position:absolute;
  width:40px;
  height:40px;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
}

#impactCursor::before,
#impactCursor::after{
  content:"";
  position:absolute;
  background:black;
}

#impactCursor::before{
  width:6px;
  height:100%;
  left:50%;
  transform:translateX(-50%);
}

#impactCursor::after{
  height:6px;
  width:100%;
  top:50%;
  transform:translateY(-50%);
}

/* ===== プレイヤー ===== */
#playerZone{
  flex:1;
  background:linear-gradient(#2b8f44,#1f8f3a);
  display:flex;
  justify-content:center;
  align-items:flex-end;
  overflow:hidden;
}

#golferImg{
  height:80%;
  object-fit:contain;
  transition:transform .3s;
}

.swing{
  transform:rotate(25deg);
}
</style>
</head>
<body>

<div id="layout">

<!-- 左：コース -->
<div id="left">
  <canvas id="ballCanvas"></canvas>
  <div id="windInfo"></div>

  <div class="club-buttons">
    <button data-power="220">1W</button>
    <button data-power="190">3W</button>
    <button data-power="160" class="active">5I</button>
    <button data-power="140">7I</button>
    <button data-power="110">9I</button>
    <button data-power="60">SW</button>
  </div>
</div>

<!-- 右 -->
<div id="right">
  <div id="impactZone">
    <div id="ballUI">
      <div id="ballCircle"></div>
      <div id="impactCursor"></div>
    </div>
  </div>

  <div id="playerZone">
    <img id="golferImg" src="assets/golfer.png">
  </div>
</div>

</div>

<script>
/* ===== スマホvh補正（重要） ===== */
function setRealHeight(){
  document.body.style.height = window.innerHeight + "px";
}
window.addEventListener("resize", setRealHeight);
setRealHeight();

/* ===== ゲーム処理 ===== */
const canvas = document.getElementById("ballCanvas");
const ctx = canvas.getContext("2d");

let clubPower=160;
let windSpeed=Math.random()*2;
let windDir=Math.random()*360;

let ball={x:100,y:400};
let velocity={x:0,y:0};

let phase="vertical";
let cursorY=0;
let cursorX=0;
let direction=1;

function resize(){
  canvas.width=canvas.parentElement.clientWidth;
  canvas.height=canvas.parentElement.clientHeight;
  ball.y=canvas.height-60;
}
window.addEventListener("resize",resize);
resize();

document.getElementById("windInfo").innerText=
  `風向:${Math.floor(windDir)}° 風速:${windSpeed.toFixed(1)}m`;

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle="rgba(0,0,0,.2)";
  ctx.beginPath();
  ctx.ellipse(canvas.width-120,120,120,60,0,0,Math.PI*2);
  ctx.fill();

  ctx.fillStyle="white";
  ctx.beginPath();
  ctx.arc(ball.x,ball.y,6,0,Math.PI*2);
  ctx.fill();
}

function animateBall(){
  ball.x+=velocity.x;
  ball.y+=velocity.y;

  velocity.x+=Math.cos(windDir*Math.PI/180)*windSpeed*0.02;
  velocity.x*=0.99;
  velocity.y*=0.99;

  draw();
  requestAnimationFrame(animateBall);
}
animateBall();

/* クラブ */
document.querySelectorAll(".club-buttons button").forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll(".club-buttons button")
      .forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    clubPower=Number(btn.dataset.power);
  }
});

/* カーソル自動移動 */
function moveCursor(){
  const cursor=document.getElementById("impactCursor");

  if(phase==="vertical"){
    cursorY+=direction*2;
    if(cursorY>50||cursorY<-50) direction*=-1;
    cursor.style.top=50+cursorY+"%";
  }

  if(phase==="horizontal"){
    cursorX+=direction*2;
    if(cursorX>50||cursorX<-50) direction*=-1;
    cursor.style.left=50+cursorX+"%";
  }

  requestAnimationFrame(moveCursor);
}
moveCursor();

/* タップ処理 */
document.getElementById("impactZone").addEventListener("click",()=>{
  if(phase==="vertical"){
    phase="horizontal";
    direction=1;
  }else if(phase==="horizontal"){
    phase="done";
    swing();
  }
});

function swing(){
  const golfer=document.getElementById("golferImg");
  golfer.classList.add("swing");
  setTimeout(()=>golfer.classList.remove("swing"),300);

  let topAdjust=-cursorY*0.2;
  let sideAdjust=cursorX*0.3;

  velocity.x=clubPower*0.05+sideAdjust;
  velocity.y=topAdjust;

  setTimeout(()=>{
    phase="vertical";
    cursorX=0;
    cursorY=0;
  },800);
}
</script>

</body>
</html>
