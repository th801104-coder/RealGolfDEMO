<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Real Golf!</title>

<style>
html,body{
  margin:0;
  height:100%;
  overflow:hidden;
  font-family:sans-serif;
}

/* ====== 常に横2分割 ====== */
#layout{
  display:flex;
  width:100vw;
  height:100vh;
  flex-direction:row; /* ←固定 */
}

/* ====== 左：コース ====== */
#left{
  width:50vw;
  height:100vh;
  background:#1f8f3a;
  position:relative;
}

#ballCanvas{
  position:absolute;
  inset:0;
}

#windInfo{
  position:absolute;
  top:10px;
  left:10px;
  background:rgba(0,0,0,.4);
  color:white;
  padding:6px 10px;
  border-radius:8px;
  font-size:14px;
}

.club-buttons{
  position:absolute;
  bottom:15px;
  left:10px;
  display:flex;
  gap:6px;
}

.club-buttons button{
  padding:8px 12px;
  border:none;
  border-radius:8px;
  font-weight:bold;
  font-size:14px;
}

.club-buttons button.active{
  outline:3px solid gold;
}

/* ====== 右 ====== */
#right{
  width:50vw;
  height:100vh;
  display:flex;
  flex-direction:column;
}

/* ====== ボールUI ====== */
#impactZone{
  flex:1;
  background:#111;
  display:flex;
  justify-content:center;
  align-items:center;
  position:relative;
}

#ballUI{
  width:200px;
  height:200px;
  position:relative;
}

#ballCircle{
  width:100%;
  height:100%;
  border-radius:50%;
  background:radial-gradient(circle at 30% 30%, white, #ddd);
}

#impactCursor{
  position:absolute;
  width:18px;
  height:18px;
  border:3px solid yellow;
  border-radius:4px;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
}

/* ====== プレイヤー ====== */
#playerZone{
  flex:1;
  background:linear-gradient(#2b8f44,#1f8f3a);
  display:flex;
  justify-content:center;
  align-items:flex-end;
  overflow:hidden;
}

#golferImg{
  height:90%;
  object-fit:contain;
  transition:transform .3s;
}

.swing{
  transform:rotate(20deg);
}
</style>
</head>
<body>

<div id="layout">

<!-- 左 -->
<div id="left">
  <canvas id="ballCanvas"></canvas>
  <div id="windInfo"></div>

  <div class="club-buttons">
    <button data-power="220">1W</button>
    <button data-power="190">3W</button>
    <button data-power="160" class="active">5I</button>
    <button data-power="140">7I</button>
    <button data-power="110">9I</button>
    <button data-power="60">SW</button>
  </div>
</div>

<!-- 右 -->
<div id="right">
  <div id="impactZone">
    <div id="ballUI">
      <div id="ballCircle"></div>
      <div id="impactCursor"></div>
    </div>
  </div>
  <div id="playerZone">
    <img id="golferImg" src="assets/golfer.png">
  </div>
</div>

</div>

<script>
const canvas = document.getElementById("ballCanvas");
const ctx = canvas.getContext("2d");

let clubPower = 160;
let windSpeed = 0;
let windDir = 0;
let ball = {x:100,y:400};
let velocity = {x:0,y:0};
let impact = {x:0,y:0};

function resizeCanvas(){
  canvas.width = canvas.parentElement.clientWidth;
  canvas.height = canvas.parentElement.clientHeight;
  ball.y = canvas.height - 60;
}
window.addEventListener("resize",resizeCanvas);
resizeCanvas();

function generateWind(){
  windSpeed = Math.random()*3;
  windDir = Math.random()*360;
  document.getElementById("windInfo").innerText =
    `風向:${Math.floor(windDir)}° 風速:${windSpeed.toFixed(1)}m`;
}
generateWind();

function drawCourse(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // グリーン
  ctx.fillStyle="rgba(0,0,0,.2)";
  ctx.beginPath();
  ctx.ellipse(canvas.width-120,120,120,60,0,0,Math.PI*2);
  ctx.fill();

  // ボール
  ctx.fillStyle="white";
  ctx.beginPath();
  ctx.arc(ball.x,ball.y,6,0,Math.PI*2);
  ctx.fill();
}

function animate(){
  ball.x += velocity.x;
  ball.y += velocity.y;

  // 風
  velocity.x += Math.cos(windDir*Math.PI/180)*windSpeed*0.02;

  // 摩擦
  velocity.x *= 0.99;
  velocity.y *= 0.99;

  drawCourse();
  requestAnimationFrame(animate);
}
animate();

/* クラブ */
document.querySelectorAll(".club-buttons button").forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll(".club-buttons button")
      .forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    clubPower = Number(btn.dataset.power);
  };
});

/* インパクト処理（上下左右反映） */
document.getElementById("impactZone").addEventListener("click",(e)=>{
  const rect = e.currentTarget.getBoundingClientRect();
  const centerX = rect.left + rect.width/2;
  const centerY = rect.top + rect.height/2;

  impact.x = (e.clientX - centerX) / 80; // 左右
  impact.y = (e.clientY - centerY) / 80; // 上下

  document.getElementById("impactCursor").style.left =
    50 + impact.x*20 + "%";
  document.getElementById("impactCursor").style.top =
    50 + impact.y*20 + "%";

  swing();
});

function swing(){
  const golfer = document.getElementById("golferImg");
  golfer.classList.add("swing");
  setTimeout(()=>golfer.classList.remove("swing"),300);

  // 上下でトップ・ダフリ
  let heightAdjust = -impact.y * 4;

  // 左右でフック・スライス
  let sideAdjust = impact.x * 5;

  velocity.x = clubPower*0.05 + sideAdjust;
  velocity.y = heightAdjust;
}
</script>

</body>
</html>
